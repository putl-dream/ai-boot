## 权限角色管理 RBAC
> 用户登录 ->
- 获得角色信息

> 用户使用功能 ->
- 功能对外暴露 -> 我需要什么权限
- 业务层根据角色 -> 获取所有权限，判断是否符合
- 符合 -> 放行
- 不符合 -> 拒绝

> 系统 ->
- 通过springBean自动获取所有需要权限校验的Bean
- 将Bean注入到数据库

> 管理员 ->
- 管理员将功能分配给角色
- 管理功能与角色之间的关系

### 细节方向
系统启动时，从SpringBean中获取到所有需要权限的功能层比如实现一个自定义接口，将所有实现这个接口的方法注入到List中。
初始化时，存入所有功能信息；创建两个角色，一个超级管理员，一个普通管理员，分别分配初始权限。用户注册时，为用户添加默认角色

管理员登录系统后，可以对角色和权限进行管理，为用户管理角色分配不同功能点，当用户修改用户角色、角色修改时，更新统一权限版本信息（时间 || 版本号等）。

业务处理时，在使用功能处理时，传入用户上下文信息，进行身份校验，通过则继续往下执行。

用户登录时，token 校验通过后，校验鉴权版本号是否与系统版本信息一致。如果不一致返回指定code，让前台动态刷新token，更新redis权限信息。

权限版本信息一致，通过redis查询用户权限信息，比对版本信息，一致直接使用，否者从数据库查询权限信息，并更新redis。

## 数据层权限管理 ABAC
数据级鉴权基于属性（如数据的所有者、类型、标签）判断，通常结合ABAC（Attribute-Based Access Control）或行级安全（Row-Level Security）。这能防止越权查询或修改数据库记录。
```java
// Service 或 Mapper 查询时
String sql = "SELECT * FROM model_types WHERE 1=1";

// 1. 普通用户：只能看自己的 + 公开的
if (!user.isAdmin()) {
    sql += " AND (owner_id = #{userId} OR access_level = 'public')";
}

// 2. 管理员：无限制
// if (user.isAdmin()) → 不加任何条件

// 3. 组内共享（可选）
if (user.hasGroup(1001)) {
    sql += " AND (group_id = 1001 OR access_level IN ('group', 'public'))";
}
```

> 数据鉴权是在数据Mapper层中添加限制条件来处理数据鉴权 \
> 数据层的鉴权校验，不是判断用户是否权限，而是你只能获取这些限制条件下的数据